{"version":3,"sources":["../../src/scripts/index.js"],"names":["WIDTH","HEIGHT","MUTATION","PALETTE","TYPES","length","Grid","width","height","curr","Array","fill","map","next","done","y","x","val","Math","random","floor","getDominant","ctx","beginPath","fillStyle","fillRect","neighbors","dx","dy","getNeighbors","max","Infinity","maxI","i","setup","window","canvas","document","createElement","getContext","body","appendChild","grid","nextframe","init","cancelAnimationFrame","clearRect","reset","requestAnimationFrame","draw","update","setTimeout"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Constants\n */\n\nconst WIDTH = 100;\nconst HEIGHT = 100;\nconst MUTATION = 0.001;\nconst PALETTE = [\"#1e272e\", \"#f6e58d\", \"#ffbe76\", \"#ff7979\", \"#badc58\", \"#7ed6df\", \"#e056fd\", \"#686de0\", \"#30336b\"]\nconst TYPES = PALETTE.length;\n\n/**\n * Cellular automata\n */\n\nclass Grid {\n\tconstructor(width, height) {\n\t\tthis.curr = new Array(height).fill(null).map(_ => new Array(width).fill(0));\n\t\tthis.next = new Array(height).fill(null).map(_ => new Array(width).fill(0));\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.done = false;\n\t}\n\n\tupdate() {\n\t\t// Automata\n\t\tfor (let y = 1; y < this.height - 1; ++y) {\n\t\t\tfor (let x = 1; x < this.width - 1; ++x) {\n\t\t\t\tconst val = this.curr[y][x];\n\n\t\t\t\tif (val === 0) {\n\t\t\t\t\t// Mutation for empty cells\n\t\t\t\t\tif (Math.random() < MUTATION) {\n\t\t\t\t\t\tthis.next[y][x] = Math.floor(Math.random()*(TYPES-1) + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Cells spread\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.next[y][x] = this.getDominant(x, y);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Update next to curr\n\t\tthis.done = true;\n\n\t\tfor (let y = 0; y < this.height; ++y) {\n\t\t\tfor (let x = 0; x < this.width; ++x) {\n\t\t\t\tif (this.curr[y][x] !== this.next[y][x]) {\n\t\t\t\t\tthis.done = false;\n\t\t\t\t}\n\t\t\t\tthis.curr[y][x] = this.next[y][x];\n\t\t\t}\n\t\t}\n\t}\n\n\tdraw() {\n\t\tfor (let y = 0; y < this.height; ++y) {\n\t\t\tfor (let x = 0; x < this.width; ++x) {\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.fillStyle = PALETTE[this.curr[y][x]];\n\t\t\t\tctx.fillRect(x, y, 1, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetNeighbors(x, y) {\n\t\tlet neighbors = new Array(TYPES).fill(0);\n\n\t\tfor (let dx = -1; dx <= 1; ++dx) {\n\t\t\tfor (let dy = -1; dy <= 1; ++dy) {\n\t\t\t\tif (dx == 0 && dy == 0) continue;\n\t\t\t\t++neighbors[this.curr[y+dy][x+dx]];\n\t\t\t}\n\t\t}\n\n\t\treturn neighbors;\n\t}\n\n\tgetDominant(x, y) {\n\t\tconst neighbors = this.getNeighbors(x, y);\n\n\t\tlet max = -Infinity;\n\t\tlet maxI = 0;\n\n\t\tfor (let i = 1; i < TYPES; ++i) {\n\t\t\tif (max < neighbors[i] || (max == neighbors[i] && Math.random() < 0.5)) {\n\t\t\t\tmax = neighbors[i];\n\t\t\t\tmaxI = i;\n\t\t\t}\n\t\t}\n\n\t\tif (max > 0) {\n\t\t\treturn maxI;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\treset() {\n\t\tfor (let y = 0; y < this.height; ++y) {\n\t\t\tfor (let x = 0; x < this.width; ++x) {\n\t\t\t\tthis.curr[y][x] = 0;\n\t\t\t\tthis.next[y][x] = 0;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Setup\n */\n\nfunction setup() {\n\twindow.canvas = document.createElement(\"canvas\");\n\twindow.ctx = canvas.getContext(\"2d\");\n\tcanvas.width = WIDTH\n\tcanvas.height = HEIGHT\n\t\n\tdocument.body.appendChild(canvas);\n\n\twindow.grid = new Grid(WIDTH, HEIGHT);\n\n\twindow.nextframe = null;\n\n\tinit();\n}\n\n/**\n * Init\n */\n\nfunction init() {\n\tcancelAnimationFrame(nextframe);\n\n\tctx.clearRect(0, 0, WIDTH, HEIGHT);\n\tgrid.reset();\n\n\tnextframe = requestAnimationFrame(draw);\n}\n\n/**\n * Drawing\n */\n\nfunction draw() {\n\tgrid.update();\n\tgrid.draw();\n\n\tif (grid.done === false) {\n\t\tnextframe = requestAnimationFrame(draw);\n\t} else {\n\t\tsetTimeout(init, 1000);\n\t}\n}\n\nsetup();"]}